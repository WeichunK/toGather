<!DOCTYPE html>
<html lang="en">

<head>

    <link rel="stylesheet" type="text/css" href="styles/header_footer.css">


    <link rel="stylesheet" type="text/css" href="styles/sign.css">


    <script type="module">
        import { Toast } from 'bootstrap.esm.min.js'

        Array.from(document.querySelectorAll('.toast'))
            .forEach(toastNode => new Toast(toastNode))
    </script>



    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>


</head>

<body style="background-color: rgb(205, 242, 245);">


    <div class='wrap'>

        <div id="header">

            <div class="main-header">
                <a class="logo name" href="/index.html">
                    <!-- <img src="https://www.pngkit.com/png/full/207-2070900_the-gathering-logo-clear-gathering-word.png"
                        height="48"> -->

                    <img src="./assets/logo3.png" height="48">


                </a>
                <!-- <div class="main-nav">
                    <a href="/index.html?tag=women" class="tag">女裝</a>
                    <div class="tag-line">|</div>
                    <a href="/index.html?tag=men" class="tag">男裝</a>
                    <div class="tag-line">|</div>
                    <a href="/index.html?tag=accessories" class="tag">配件</a>

                </div> -->

                <!-- <input class="search" /> -->

                <!-- <a class="cart">
                    <img src="/img/icons/cart.png" height="44" />
                    <div class="count">0</div>
                </a> -->

                <div class="member">
                    <a href="/profile.html"><img src="https://dft5bbbk1fziz.cloudfront.net/img/icons/member.png"
                            height="44"></a>
                </div>


            </div>

        </div>


        <div id="left">



            <img src="./assets/logo4.png" height="30%">

            <h6>讓您隨時隨地認識新朋友</h6>

        </div>


        <div id="right">




            <div id="card">


                <form method="post" action="/api/1.0/user/signin" enctype="application/json" class="form">





                    <div class="mb-3">

                        <input type="email" class="form-control" id="email" name="email" aria-describedby="emailHelp"
                            placeholder="電子郵件">

                    </div>




                    <div class="mb-3">

                        <input type="password" class="form-control" id="password" name="password" placeholder="密碼">
                    </div>



                    <button class="btn btn-primary" id="signIn" onclick="return onClick(this.form)">登入</button>
                </form>

                <div class="divider">

                </div>

                <div id="signUp">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                        data-bs-target="#staticBackdrop" id="signUpButton">
                        建立新帳號
                    </button>

                </div>


            </div>





        </div>






        <!-- Modal -->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 class="modal-title" id="staticBackdropLabel">請輸入註冊資料</h6>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">






                        <form method="post" action="/api/1.0/user/signup" enctype="application/json">





                            <div class="mb-3">

                                <input class="form-control" type="text" placeholder="使用者名稱"
                                    aria-label="default input example" name="name">
                                <!-- <div id="titleHelp" class="form-text">We'll never share your email with anyone else.</div> -->
                            </div>



                            <div class="mb-3">

                                <input type="email" class="form-control" name="email" aria-describedby="emailHelp"
                                    placeholder="電子郵件">

                            </div>


                            <div class="mb-3">

                                <input type="password" class="form-control" name="password" placeholder="密碼">
                            </div>


                            <button type="submit" class="btn btn-primary" id="signup_submit"
                                onclick="return onClickSignUp(this.form)">確定註冊</button>



                        </form>






                    </div>

                </div>
            </div>
        </div>










        <script>


            function onClick(form) {
                console.log('type of form', typeof (form))
                // console.log('form.title.value', form.title.value)




                if (!Boolean(form.email.value.trim())) {
                    alert("email不可為空");
                    return false;
                }
                if (!Boolean(form.password.value.trim())) {
                    alert("password不可為空！");
                    return false;
                }

                let dataToSent = { provider: "native", email: form.email.value, password: form.password.value }

                dataToSent = JSON.stringify(dataToSent)

                // dataToSent = new FormData(dataToSent)
                // dataToSent.append('provider', 'native');
                console.log("dataToSent", dataToSent);
                // fetch("/api/1.0/getgatherings/hostGathering", {

                //     body: dataToSent,
                //     headers: new Headers({
                //         "Content-Type": "multipart/form-data",
                //         "Authorization": `Bearer ${accessToken}`
                //     }),
                //     method: "POST"
                // }).then((e => e.json())).then((e => {
                //     console.log(e)
                //     alert('error')
                // }
                // )).then(window.alert("註冊成功！")).catch((e => {
                //     console.log(e)
                // }
                // ))


                let xhr = new XMLHttpRequest();
                let url = '/api/1.0/user/signin';
                xhr.open('POST', url);
                // xhr.setRequestHeader('Authorization', `Bearer ${accessToken}`);
                xhr.setRequestHeader('Content-Type', 'application/json');

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('apiResponse.data', xhr.responseText)
                        // if (xhr.responseText == 'admin') {
                        //     alert('已成功輸入一筆資料')
                        //     window.location.href = '/admin/product.html'
                        // } else {
                        //     alert('無權限操作此頁')
                        // }
                        alert('登入成功')

                        // console.log('xhr.responseText.data', JSON.parse(xhr.responseText).data)
                        localStorage.setItem("token", JSON.parse(xhr.responseText).data.access_token);
                        window.location.href = '/index.html';
                    }
                };
                xhr.send(dataToSent);



                // .finally(location.reload())



                return false
            }










            function onClickSignUp(form) {
                console.log('type of form', typeof (form))
                // console.log('form.title.value', form.title.value)


                if (!Boolean(form.name.value.trim())) {
                    alert("使用者名稱不可為空！");
                    return false;
                }

                if (!Boolean(form.email.value.trim())) {
                    alert("email不可為空");
                    return false;
                }
                if (!Boolean(form.password.value.trim())) {
                    alert("密碼不可為空！");
                    return false;
                }

                let dataToSent = { name: form.name.value, email: form.email.value, password: form.password.value }

                dataToSent = JSON.stringify(dataToSent)

                // dataToSent = JSON.stringify(dataToSent)

                // dataToSent = new FormData(dataToSent)
                // dataToSent.append('provider', 'native');
                console.log("dataToSent", dataToSent);
                // fetch("/api/1.0/getgatherings/hostGathering", {

                //     body: dataToSent,
                //     headers: new Headers({
                //         "Content-Type": "multipart/form-data",
                //         "Authorization": `Bearer ${accessToken}`
                //     }),
                //     method: "POST"
                // }).then((e => e.json())).then((e => {
                //     console.log(e)
                //     alert('error')
                // }
                // )).then(window.alert("註冊成功！")).catch((e => {
                //     console.log(e)
                // }
                // ))


                let xhr = new XMLHttpRequest();
                let url = '/api/1.0/user/signup';
                xhr.open('POST', url);
                // xhr.setRequestHeader('Authorization', `Bearer ${accessToken}`);
                xhr.setRequestHeader('Content-Type', 'application/json');

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('apiResponse.data', xhr.responseText)
                        // if (xhr.responseText == 'admin') {
                        //     alert('已成功輸入一筆資料')
                        //     window.location.href = '/admin/product.html'
                        // } else {
                        //     alert('無權限操作此頁')
                        // }
                        alert('註冊成功')
                        localStorage.setItem("token", JSON.parse(xhr.responseText).data.access_token);
                        window.location.href = '/index.html';
                    }
                };


                xhr.send(dataToSent);



                // .finally(location.reload())



                return false
            }








        </script>




</body>



</html>