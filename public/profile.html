<!DOCTYPE html>
<html lang="en">

<head>

    <link rel="stylesheet" type="text/css" href="styles/header_footer.css">


    <link rel="stylesheet" type="text/css" href="styles/profile.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        #profileList {
            margin: 0 auto;
        }
    </style>



</head>

<body>


    <div class='wrap'>


        <!-- ---------------------- header --------------------------- -->
        <div id="header">
            <nav class="navbar navbar-light fixed-top navbar-expand-lg" style="background-color: #e3f2fd;">
                <div class="container-md">

                    <a class="navbar-brand logo name" href="./index.html">
                        <img src="./assets/logo5.png" alt="" width="230" height="60">
                    </a>
                    <div id="main-header">
                        <div class="collapse navbar-collapse" id="navbarNavDropdown">
                            <ul class="navbar-nav">

                                <!-- <li class="nav-item" style="margin: 3px 10px 0 0;">
                                    <a class="nav-link" href="#">
                                        <div class="host">
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#staticBackdrop" id="hostbutton">
                                                我要開團
                                            </button>

                                        </div>
                                    </a>
                                </li> -->
                                <!-- <li class="nav-item" style="display: flex;">
                            <a class="nav-link" id="caht" href="#"><svg xmlns=" http://www.w3.org/2000/svg"
                                    width="47" height="47" fill="currentColor" class="bi bi-chat-left-text"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                                    <path
                                        d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z" />
                                </svg></a>
                        </li> -->
                                <li class="nav-item dropdown">
                                    <a class="nav-link" href="#" id="navbarDropdownMenuLink" role="button"
                                        data-bs-toggle="dropdown" aria-expanded="false">

                                        <svg xmlns="http://www.w3.org/2000/svg" width="47" height="47"
                                            fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                                            <path fill-rule="evenodd"
                                                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                                        </svg>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <li><a class="dropdown-item dropdown-sign" href="/sign.html"
                                                style="display: block;">登入</a>
                                        </li>
                                        <li><a class="dropdown-item dropdown-signed" href="/profile.html"
                                                style="display: none;">會員資料</a></li>
                                        <li>
                                            <hr class="dropdown-divider dropdown-signed" style="display: none;">
                                        </li>
                                        <li id=signout><a class="dropdown-item dropdown-signed" href="#"
                                                style="display: none;">登出</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <!-- -------------------------------------------------- -->




        <div id="left">

            <div id=profileList></div>




        </div>


        <div id="right">
        </div>




    </div>


    <script>





        // function ajax(src, callback) {

        //     if (localStorage.getItem("token")) {
        //         const accessToken = localStorage.getItem("token");
        //         let response
        //         const xhr = new XMLHttpRequest()
        //         xhr.onreadystatechange = function () {
        //             if (xhr.readyState === 4 && xhr.status === 200) {
        //                 response = JSON.parse(xhr.responseText)
        //                 // response = xhr.responseText;
        //                 callback(response)
        //             }
        //         }
        //         function sendAJAX(accessToken) {
        //             xhr.open('GET', src)
        //             if (accessToken) {
        //                 // console.log('accessToken: ', accessToken)
        //                 xhr.setRequestHeader('Authorization', `Bearer ${accessToken}`);
        //             }

        //             xhr.send()
        //         }
        //         sendAJAX(accessToken)

        //     } else {
        //         Swal.fire({
        //             title: 'Error!',
        //             text: '請先登入',
        //             icon: 'error',
        //             confirmButtonText: 'OK'
        //         })
        //     }

        // }







        // ajax('/api/1.0/user/getmemberprofile', function (response) {
        //     // console.log(response);
        //     console.log('response', response)

        //     let profileList = document.getElementById('profileList')


        //     let name = document.createElement('li')
        //     name.textContent = response.data.name;
        //     // participant.textContent = response.data[i].user_name;
        //     // participant.setAttribute('onclick', `location.href='http://localhost:3000/profile.html?id=${response.data[i].id}';`)
        //     // participant.style = `cursor:pointer;`
        //     profileList.appendChild(name);

        //     let email = document.createElement('li')
        //     console.log('response.data.email', response.data.email)
        //     email.textContent = response.data.email;
        //     profileList.appendChild(email);

        //     let gender = document.createElement('li')
        //     email.textContent = response.data.gender;
        //     profileList.appendChild(gender);



        // })











        function fetchData(src, accessToken) {
            // console.log('access', accessToken)

            function processStatus(response) {
                // 狀態 "0" 是處理本地檔案 (例如Cordova/Phonegap等等)
                if (response.status === 200 || response.status === 0) {
                    return Promise.resolve(response)
                } else {
                    return Promise.reject(new Error(response.statusText))
                }
            }

            if (accessToken) {
                const headers = {
                    // 'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                }

                return fetch(src, { headers: headers })
                    .then(processStatus)
                    .then((response) => { return response.json(); })
                    .catch((error) => {
                        console.log(error);
                    })

            } else {
                Swal.fire({
                    title: 'Error!',
                    text: '請先登入',
                    icon: 'error',
                    confirmButtonText: 'OK'
                })
            }

        }












        async function initProfile() {


            // var socket = io();

            // var hostInfo = {};
            // var user = {}
            // var gathering = {}

            const accessToken = localStorage.getItem("token")



            let url = location.href



            let profileData = await fetchData('/api/1.0/user/getmemberprofile', accessToken)

            console.log('profileData', profileData)

            let profileList = document.getElementById('profileList')
            profileList.class = "card"
            profileList.style = "width:60%;"


            let profilePic = document.createElement('img')
            profilePic.src = profileData.data.picture || '';
            profilePic.className = "card-img-top"

            profilePic.style = "height:30vh;object-fit: contain;background-image:url('https://mir-s3-cdn-cf.behance.net/project_modules/disp/a5f35a112938979.601ee0c09cecd.gif')"




            let cardBody = document.createElement('div')
            cardBody.className = "card-body";

            let cardTitle = document.createElement('h5')
            cardTitle.className = "card-title";
            cardTitle.appendChild(document.createTextNode('Introduction'))


            let cardIntroduction = document.createElement('p')
            cardIntroduction.className = "card-text";
            cardIntroduction.style = "white-space: pre-line;"
            cardIntroduction.appendChild(document.createTextNode(`${profileData.data.introduction || '未提供'}`))
            // console.log(getgatheringDetails.data[0].description)

            cardBody.appendChild(cardTitle)
            cardBody.appendChild(cardIntroduction)

            let listGroupItem

            let listGroup = document.createElement('ul');
            listGroup.className = "list-group list-group-flush";

            let email = document.createElement('li');
            email.className = "list-group-item";
            email.appendChild(document.createTextNode(`email ${profileData.data.email}`))


            let age = document.createElement('li');
            age.className = "list-group-item";
            age.appendChild(document.createTextNode(`年齡 ${profileData.data.age || '未提供'}`))


            let job = document.createElement('li');
            job.className = "list-group-item";
            job.appendChild(document.createTextNode(`職業 ${profileData.data.job || '未提供'}`))



            let popularity = document.createElement('li');
            popularity.className = "list-group-item";
            popularity.appendChild(document.createTextNode(`聲望 ${profileData.data.popularity}`))





            let changePicButton = document.createElement('a');
            changePicButton.className = "btn btn-primary";
            changePicButton.id = "changePic";
            // changePicButton.style = "display: none;"
            changePicButton.setAttribute("data-bs-toggle", "button")
            changePicButton.setAttribute("autocomplete", "off")
            changePicButton.appendChild(document.createTextNode("更換照片"))



            listGroup.appendChild(email)
            listGroup.appendChild(age)
            listGroup.appendChild(job)
            listGroup.appendChild(popularity)

            listGroup.appendChild(changePicButton)

            listGroup.appendChild(document.createElement('br'))
            // listGroup.appendChild(returnHome)



            profileList.insertBefore(listGroup, profileList.firstChild)
            // gatheringDetail.appendChild(listGroup)

            profileList.insertBefore(cardBody, profileList.firstChild)



            profileList.insertBefore(profilePic, profileList.firstChild)




            let returnHome = document.createElement('a');
            returnHome.className = "btn btn-primary btn-sm box4";


            returnHome.setAttribute("onclick", 'location.href="/index.html"')
            returnHome.setAttribute("data-bs-toggle", "button")
            returnHome.setAttribute("autocomplete", "off")
            returnHome.appendChild(document.createTextNode("回首頁"))

            profileList.appendChild(document.createElement('br'))

            profileList.appendChild(returnHome)


            let ratingData = await fetchData('/api/1.0/user/getuserrating', accessToken)

            console.log('ratingData', ratingData)



            // let profileListUl = document.createElement('ul')

            // let pic = document.createElement('li')
            // let img = document.createElement('img')



            // let name = document.createElement('li')
            // name.textContent = profileData.data.name;
            // // participant.textContent = response.data[i].user_name;
            // // participant.setAttribute('onclick', `location.href='http://localhost:3000/profile.html?id=${response.data[i].id}';`)
            // // participant.style = `cursor:pointer;`
            // profileListUl.appendChild(name);

            // let email = document.createElement('li')
            // // console.log('profileList.data.email', profileData.data.email)
            // email.textContent = profileData.data.email;
            // profileListUl.appendChild(email);

            // let gender = document.createElement('li')
            // // console.log('gender', profileData.data.gender)
            // gender.textContent = profileData.data.gender || '未提供';
            // profileListUl.appendChild(gender);

            // profileList.appendChild(profileListUl)





            // console.log('memberprofile', profileData)


            // let profileList = document.getElementById('profileList')

            // let listGroup = document.createElement('ul');
            // listGroup.className = "list-group list-group-flush";




            // let listGroupItem = document.createElement('li');
            // listGroupItem.className = "list-group-item";
            // listGroupItem.appendChild(document.createTextNode(`地點 ${getgatheringDetails.data[0].place}`))


            // let time = document.createElement('li');
            // time.className = "list-group-item";
            // time.appendChild(document.createTextNode(`時間 ${getgatheringDetails.data[0].start_at}`))



            // let minParticipant = document.createElement('li');
            // minParticipant.className = "list-group-item";
            // minParticipant.appendChild(document.createTextNode(`幾人成團 ${getgatheringDetails.data[0].min_participant}`))

















        }

        // let getgatheringDetails = await fetchData(`/ api / 1.0 / getgatherings / details ? id = ${gatheringId}`, accessToken)

        // // console.log('getgatheringDetails.data[0].lat', getgatheringDetails.data[0].lat)
        // gathering.title = getgatheringDetails.data[0].title


        // console.log('getgatheringDetails', getgatheringDetails)


        // console.log('getgatheringDetails.user', getgatheringDetails.user)

        // // console.log('getgatheringDetails.data[0]', getgatheringDetails.data[0])

        // // initMap(response.data[0].lat, response.data[0].lng)


        // hostInfo.hostName = getgatheringDetails.data[0].name
        // hostInfo.hostId = getgatheringDetails.data[0].host_id
        // hostInfo.rating = getgatheringDetails.data[0].avg_rating
        // console.log('hostInfo', hostInfo)
        // // console.log('response.data.host_id', response.data[0].host_id)



        // // let mapDiv = document.getElementById("left-map")
        // // mapDiv.style = 'height: 100%;width: 98%;'

        // const gatheringDetail = document.getElementById('gatheringDetail')

        // gatheringDetail.class = "card"
        // gatheringDetail.style = "width:60%;"


        // let eventPic = document.createElement('img')
        // eventPic.src = getgatheringDetails.data[0].picture

        // eventPic.className = "card-img-top"



        // eventPic.style = "height:30vh;object-fit: contain;background-image:url('https://mir-s3-cdn-cf.behance.net/project_modules/disp/a5f35a112938979.601ee0c09cecd.gif')"


        // // gatheringDetail.appendChild(eventPic)


        // let eventMap = document.createElement('div')
        // eventMap.id = "left-map";



        // // gatheringDetail.appendChild(eventMap)


        // let cardBody = document.createElement('div')
        // cardBody.className = "card-body";

        // let cardTitle = document.createElement('h5')
        // cardTitle.className = "card-title";
        // cardTitle.appendChild(document.createTextNode(` ${getgatheringDetails.data[0].title}`))



        // let cardDescriptiion = document.createElement('p')
        // cardDescriptiion.className = "card-text";
        // cardDescriptiion.style = "white-space: pre-line;"
        // cardDescriptiion.appendChild(document.createTextNode(` ${getgatheringDetails.data[0].description}`))
        // // console.log(getgatheringDetails.data[0].description)

        // cardBody.appendChild(cardTitle)
        // cardBody.appendChild(cardDescriptiion)




        // // gatheringDetail.appendChild(cardBody)






        // let listGroup = document.createElement('ul');
        // listGroup.className = "list-group list-group-flush";




        // let listGroupItem = document.createElement('li');
        // listGroupItem.className = "list-group-item";
        // listGroupItem.appendChild(document.createTextNode(`地點 ${getgatheringDetails.data[0].place}`))


        // let time = document.createElement('li');
        // time.className = "list-group-item";
        // time.appendChild(document.createTextNode(`時間 ${getgatheringDetails.data[0].start_at}`))



        // let minParticipant = document.createElement('li');
        // minParticipant.className = "list-group-item";
        // minParticipant.appendChild(document.createTextNode(`幾人成團 ${getgatheringDetails.data[0].min_participant}`))



        // let maxParticipant = document.createElement('li');
        // maxParticipant.className = "list-group-item";
        // maxParticipant.appendChild(document.createTextNode(`人數上限 ${getgatheringDetails.data[0].max_participant}`))


        // let currentParticipant = document.createElement('li');
        // currentParticipant.className = "list-group-item";
        // currentParticipant.appendChild(document.createTextNode(`目前人數 ${parseInt(gathering.numOfParticipants) + 1
        //     } `))



        // let statusCode = document.createElement('li');
        // statusCode.className = "list-group-item";
        // statusCode.appendChild(document.createTextNode(`狀態 ${getgatheringDetails.data[0].status} `))



        // let host = document.createElement('li');
        // host.className = "list-group-item";
        // host.appendChild(document.createTextNode(`主揪 ${hostInfo.hostName}`))


        // let joinEventButton = document.createElement('a');
        // joinEventButton.className = "btn btn-primary";
        // joinEventButton.id = "joinEvent";
        // joinEventButton.style = "display: none;"
        // joinEventButton.setAttribute("data-bs-toggle", "button")
        // joinEventButton.setAttribute("autocomplete", "off")
        // joinEventButton.appendChild(document.createTextNode("我要加入"))


        // let quitEventButton = document.createElement('a');
        // quitEventButton.className = "btn btn-primary";
        // quitEventButton.id = "quitEvent";
        // quitEventButton.style = "display: none;"
        // quitEventButton.setAttribute("data-bs-toggle", "button")
        // quitEventButton.setAttribute("autocomplete", "off")
        // quitEventButton.appendChild(document.createTextNode("我要退出"))


        // let fullEventButton = document.createElement('a');
        // fullEventButton.className = "btn ";
        // fullEventButton.id = "fullEvent";
        // fullEventButton.style = "display: none; background-color: 'rebeccapurple';"
        // fullEventButton.setAttribute("data-bs-toggle", "button")
        // fullEventButton.setAttribute("autocomplete", "off")
        // fullEventButton.appendChild(document.createTextNode("名額已滿"))


        // console.log('check', parseInt(gathering.numOfParticipants) + 1, getgatheringDetails.data[0].max_participant)
        // if ((parseInt(gathering.numOfParticipants) + 1) >= getgatheringDetails.data[0].max_participant) {
        //     joinEventButton.style = "display: none;"
        //     fullEventButton.style = "display: block;"
        // } else {
        //     joinEventButton.style = "display: block;"
        //     fullEventButton.style = "display: none;"
        // }

        // // let returnHome = document.createElement('a');
        // // returnHome.className = "btn btn-primary btn-sm box4";


        // // returnHome.setAttribute("onclick", 'location.href=" /index.html"')
        // // returnHome.setAttribute("data-bs-toggle", "button")
        // // returnHome.setAttribute("autocomplete", "off")
        // // returnHome.appendChild(document.createTextNode("回首頁"))




        // listGroup.appendChild(listGroupItem)
        // listGroup.appendChild(time)
        // listGroup.appendChild(minParticipant)
        // listGroup.appendChild(maxParticipant)
        // listGroup.appendChild(currentParticipant)

        // listGroup.appendChild(statusCode)
        // listGroup.appendChild(host)
        // listGroup.appendChild(joinEventButton)
        // listGroup.appendChild(quitEventButton)
        // listGroup.appendChild(fullEventButton)

        // listGroup.appendChild(document.createElement('br'))
        // // listGroup.appendChild(returnHome)



        // gatheringDetail.insertBefore(listGroup, gatheringDetail.firstChild)
        // // gatheringDetail.appendChild(listGroup)

        // gatheringDetail.insertBefore(cardBody, gatheringDetail.firstChild)

        // gatheringDetail.insertBefore(eventMap, gatheringDetail.firstChild)

        // gatheringDetail.insertBefore(eventPic, gatheringDetail.firstChild)




        // let returnHome = document.createElement('a');
        // returnHome.className = "btn btn-primary btn-sm box4";


        // returnHome.setAttribute("onclick", 'location.href=" /index.html"')
        // returnHome.setAttribute("data-bs-toggle", "button")
        // returnHome.setAttribute("autocomplete", "off")
        // returnHome.appendChild(document.createTextNode("回首頁"))

        // gatheringDetail.appendChild(document.createElement('br'))

        // gatheringDetail.appendChild(returnHome)


        // statusCode






        initProfile()














    </script>







    <script>







        document.getElementById("navbarDropdownMenuLink").addEventListener('click', () => {
            if (!localStorage.getItem('token')) {
                document.getElementsByClassName('dropdown-sign')[0].style = "display: block;"
                let sign = document.getElementsByClassName('dropdown-signed')
                for (i = 0; i < sign.length; i++) {
                    sign[i].style.display = "none";
                }

            } else {
                document.getElementsByClassName('dropdown-sign')[0].style = "display: none;"
                let signed = document.getElementsByClassName('dropdown-signed')
                for (i = 0; i < signed.length; i++) {
                    signed[i].style.display = "block";
                }

            }

        })


        document.getElementById("signout").addEventListener('click', () => {
            localStorage.removeItem("token")


            Swal.fire({
                title: 'Success!',
                text: '已將您登出',
                icon: 'success',
                confirmButtonText: 'OK'
            }).then(function () {
                window.location.href = '/sign.html'
            })

        })




    </script>







    <script>







    </script>
















</body>



</html>