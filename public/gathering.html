<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Project</title>

    <!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script> -->


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- <link rel="stylesheet" type="text/css" href="styles/map.css"> -->

    <script src="/socket.io/socket.io.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <script>
        // var socket = io();
    </script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>



    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="styles/header_footer.css">
    <link rel="stylesheet" type="text/css" href="./styles/gathering.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style type="text/css">

    </style>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">






</head>

<body>





    <div class='wrap'>



        <!-- ---------------------- header --------------------------- -->
        <!-- #e3f2fd; -->
        <div id="header" style="position: absolute;">
            <nav class="navbar navbar-light fixed-top navbar-expand-lg"
                style="background-color: rgba(255, 255, 255); padding:0%; padding-top: 5px">
                <div class="container-md" style="width: 90%; max-width: 90%; height:60px">

                    <a class="navbar-brand logo name" href="./index.html">
                        <img src="./assets/new_logo2.png" alt="" height="35">
                    </a>
                    <div id="main-header">
                        <div class="collapse navbar-collapse" id="navbarNavDropdown">
                            <ul class="navbar-nav" style="align-items: center;">


                                <li class="nav-item" style="margin: 0 0 0 0;" data-bs-toggle="offcanvas"
                                    data-bs-target="#offcanvasWithBackdrop" aria-controls="offcanvasWithBackdrop">
                                    <a class="nav-link" href="#" style="display: flex;">
                                        <!-- <img src="./assets/6590582_box_email_mail_mailbox_icon.png"
                                            style="width: 36px;"> -->

                                        <span class="material-icons">
                                            all_inbox
                                        </span>
                                    </a>
                                </li>
                                <!-- <li class="nav-item" style="display: flex;">
                                    <a class="nav-link" id="caht" href="#"><svg xmlns=" http://www.w3.org/2000/svg"
                                            width="47" height="47" fill="currentColor" class="bi bi-chat-left-text"
                                            viewBox="0 0 16 16">
                                            <path
                                                d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                                            <path
                                                d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z" />
                                        </svg></a>
                                </li> -->
                                <li class="nav-item dropdown" style="margin: 0 0 0 0;">
                                    <a class="nav-link" href="#" id="navbarDropdownMenuLink" role="button"
                                        data-bs-toggle="dropdown" aria-expanded="false" style="display: flex;">

                                        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="47" height="47"
                                            fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                                            <path fill-rule="evenodd"
                                                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                                        </svg> -->
                                        <!-- <img src="./assets/3018530_buyer_customer_figure_person_portrait_icon.png"
                                            style="width: 36px;"> -->
                                        <span class="material-icons">
                                            account_circle
                                        </span>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-lg-end"
                                        aria-labelledby="navbarDropdownMenuLink">
                                        <li><a class="dropdown-item dropdown-sign" href="/sign.html"
                                                style="display: block;">登入</a>
                                        </li>
                                        <li><a class="dropdown-item dropdown-signed" href="/profile.html"
                                                style="display: none;">會員資料</a></li>
                                        <li>
                                            <hr class="dropdown-divider dropdown-signed" style="display: none;">
                                        </li>
                                        <li id=signout><a class="dropdown-item dropdown-signed" href="#"
                                                style="display: none;">登出</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <!-- -------------------------------------------------- -->



        <div id="two-column">


            <div id="center">


                <div id="gatheringDetail">



                    <!-- -----------------------------status bar------------------------------------ -->
                    <div class="rating-container">

                        <div class="container-status">
                            <!-- <h5>狀態</h5> -->
                            <div class="skillbox">
                                <div class="html">
                                    <div style="display: flex; justify-content: space-between;">
                                        <h3 style="display: inline;">已開團</h3>
                                        <h3 style="display: inline;">招募中</h3>
                                        <h3 style="display: inline;">已額滿</h3>
                                        <h3 style="display: inline;">已結束</h3>
                                    </div>
                                    <!-- <span class="percentage">90%</span> -->
                                    <div class="cover">
                                        <div class="progressbar" id="progressbar"></div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- ------------------------------------------------------------ -->




                        <div id="left-map"></div>


                        <br>


                        <div class="rating-box" style="position:relative; width: 100%;">
                            <h5 class="rating-boxH1" style="text-align: center;">目前的評分</h5>
                            <div class="ratingResult" style="text-align: center;">
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;"></span>
                            </div>
                            <p id="rating-description" class="text-muted" style="text-align: center;">目前尚未有人給評分</p>
                            <h4 id="rating-value">
                                </h1>
                        </div>



                        <br>
                        <!-- <form class="col"> -->












                        <div class="rating-box" style="position:relative; width: 100%;">
                            <h5 class="rating-boxH1" style="text-align: center;">我要給評分和評論</h5>
                            <div class="rating" style="text-align: center; cursor: pointer;">
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;" data-bs-toggle="modal"
                                    data-bs-target="#commentModal" data-bs-rating="1"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;" data-bs-toggle="modal"
                                    data-bs-target="#commentModal" data-bs-rating="2"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;" data-bs-toggle="modal"
                                    data-bs-target="#commentModal" data-bs-rating="3"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;" data-bs-toggle="modal"
                                    data-bs-target="#commentModal" data-bs-rating="4"></span>
                                <span class="fa fa-star-o" style="font-size:36px; color: gold;" data-bs-toggle="modal"
                                    data-bs-target="#commentModal" data-bs-rating="5"></span>
                            </div>
                            <h4 id="rating-value">
                                </h1>
                        </div>

                    </div>
                    <!-- -----------------------  mouse ------------------------- -->


                    <!-- <div class="centered">
                        <div class="mouse-scroll"></div>
                    </div> -->





                    <div id="commentList">


                    </div>


                    <!-- ---------------------- comment----------------------- -->






                    <div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="commentModalLabel">New message</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form>

                                        <div class="mb-3">
                                            <label for="message-text" class="col-form-label">Message:</label>
                                            <textarea class="form-control" id="message-text"
                                                placeholder="請在此留下評論（選填）"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-primary" id="sendCommentButton">確定送出</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>








            </div>


            <div id="sticky-block">



                <div class="card" style="display:flex; width: 18rem; align-items: center;" id="action-buttons">
                    <div class="card-body">
                        <h5 class="card-title">有趣的活動正在等著你</h5>
                        <!-- <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6> -->
                        <p class="card-text">趕快來參加，和朋友一起享受歡樂時光吧</p>
                        <!-- <a href="#" class="btn btn-white btn-animate" data-bs-toggle="modal"
                            data-bs-target="#staticBackdrop" id="hostbutton">我要加入</a> -->

                        <a href="#" class="btn btn-white btn-animate" id="joinEvent" data-bs-toggle="button"
                            autocomplete="off" style="display: block;">我要加入</a>
                        <!-- <a class="btn btn-secondary" id="quitEvent" data-bs-toggle="button" autocomplete="off"
                            style="display: none;">我要退出</a> -->
                        <a class="btn " id="fullEvent" data-bs-toggle="button" autocomplete="off"
                            style="display: none;">名額已滿</a>

                    </div>
                </div>



            </div>





        </div>





        <!-- <div id="left-block">



        </div> -->









        <div id=right style="display:none;" class="position-absolute bottom-0 end-0 p-5">

            <div id=groupChatRoom style="height: 95vh;">

                <h6 style=" text-align: center; margin-top: 10px;">成員</h6> <a class="btn btn-secondary" id="quitEvent"
                    data-bs-toggle="button" autocomplete="off" style="display: none;">我要退出</a>
                <ul id="participants"></ul>

                <h6 style=" text-align: center;">群組聊天室</h6>

                <ul id="messages"></ul>
                <div>
                    <form id="messagesForm" action="" style="border-radius:20px;">
                        <input id="messageInput" autocomplete="off" /> <button
                            class="btn-send btn-secondary rounded-pill" id="submit-msg">Send</button>
                    </form>
                </div>
            </div>

        </div>

    </div>

    <script src="./src/rating.js"></script>





    <!-- --------------------------remove participant---------------------------------------- -->

    <div class="modal fade" id="removeParticipantModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">注意</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="removeParticipantModalBody">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="removeParticipantModalConfirm"
                        data-bs-dismiss="modal">確定</button>
                </div>
            </div>
        </div>
    </div>





    <!-- --------------------------------------------------------------------------- -->


    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasWithBackdrop"
        aria-labelledby="offcanvasWithBackdropLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasWithBackdropLabel">系統訊息</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="card" style="width: 100%;">
                <ul class="list-group list-group-flush" id=sys-message-list>

                </ul>
            </div>
        </div>
    </div>













    <script>







        function fetchData(src, accessToken) {
            // console.log('access', accessToken)

            function processStatus(response) {
                // 狀態 "0" 是處理本地檔案 (例如Cordova/Phonegap等等)
                if (response.status === 200 || response.status === 0) {
                    return Promise.resolve(response)
                } else if (response.status === 403) {

                    return Promise.resolve(response)
                } else {
                    return Promise.reject(new Error(response.statusText))
                }
            }

            if (accessToken) {
                const headers = {
                    // 'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                }

                return fetch(src, { headers: headers })
                    .then(processStatus)
                    .then((response) => { return response.json(); })
                    .catch((error) => {
                        console.log(error);
                    })

            } else {
                const headers = {}
                return fetch(src)
                    .then(processStatus)
                    .then((response) => { return response.json(); })
                    .catch((error) => {
                        console.log(error);
                    })
            }






        }





        async function initMap() {


            var socket = io();

            var hostInfo = {};
            var user = {}
            var gathering = {}

            const accessToken = localStorage.getItem("token")



            let url = location.href

            if (url.indexOf('?') !== -1 & url.split('?')[1].split('=')[0] == 'id') {
                const gatheringId = url.split('?')[1].split('=')[1]
                console.log('gatheringId', gatheringId)


                // let accessToken = localStorage.getItem("token")

                let participantsData = await fetchData(`/api/1.0/getgatherings/participants?id=${gatheringId}`, accessToken)

                console.log('participantsData', participantsData, gatheringId)
                gathering.numOfParticipants = participantsData.data.length

                console.log('gathering', gathering)




                let getgatheringDetails = await fetchData(`/api/1.0/getgatherings/details?id=${gatheringId}`, accessToken)

                let commentList = await fetchData(`/api/1.0/gatherings/getcomment?id=${gatheringId}`, accessToken)


                console.log('commentList', commentList)

                // console.log('getgatheringDetails.data[0].lat', getgatheringDetails.data[0].lat)
                gathering.title = getgatheringDetails.data[0].title


                console.log('getgatheringDetails', getgatheringDetails)


                console.log('getgatheringDetails.user', getgatheringDetails.user)

                // console.log('getgatheringDetails.data[0]', getgatheringDetails.data[0])

                // initMap(response.data[0].lat, response.data[0].lng)


                hostInfo.hostName = getgatheringDetails.data[0].name
                hostInfo.hostId = getgatheringDetails.data[0].host_id
                hostInfo.rating = getgatheringDetails.data[0].avg_rating
                hostInfo.picture = getgatheringDetails.data[0].host_pic
                console.log('hostInfo', hostInfo)
                // console.log('response.data.host_id', response.data[0].host_id)



                // let mapDiv = document.getElementById("left-map")
                // mapDiv.style = 'height: 100%;width: 98%;'

                const gatheringDetail = document.getElementById('gatheringDetail')

                gatheringDetail.class = "card"



                let eventPic = document.createElement('img')
                eventPic.src = getgatheringDetails.data[0].picture

                eventPic.className = "card-img-top"


                // ---------origin setting-----------
                // eventPic.style = "height:30vh;object-fit: contain;background-image:url('https://mir-s3-cdn-cf.behance.net/project_modules/disp/a5f35a112938979.601ee0c09cecd.gif')"
                // ---------------------------


                eventPic.style = "width:82%; object-fit: contain;background-image:url('https://mir-s3-cdn-cf.behance.net/project_modules/disp/a5f35a112938979.601ee0c09cecd.gif')"


                // gatheringDetail.appendChild(eventPic)


                // let eventMap = document.createElement('div')
                // eventMap.id = "left-map";
                // eventMap = document.getElementById('left-map')


                // gatheringDetail.appendChild(eventMap)


                let cardBody = document.createElement('div')
                cardBody.className = "card-body";

                let cardTitle = document.createElement('h5')
                cardTitle.className = "card-title";
                cardTitle.appendChild(document.createTextNode(` ${getgatheringDetails.data[0].title}`))



                let cardDescriptiion = document.createElement('p')
                cardDescriptiion.className = "card-text";
                cardDescriptiion.style = "white-space: pre-line;"
                cardDescriptiion.appendChild(document.createTextNode(` ${getgatheringDetails.data[0].description}`))
                // console.log(getgatheringDetails.data[0].description)

                cardBody.appendChild(cardTitle)
                cardBody.appendChild(cardDescriptiion)




                // gatheringDetail.appendChild(cardBody)






                let listGroup = document.createElement('ul');
                listGroup.className = "list-group list-group-flush";




                let listGroupItem = document.createElement('li');
                listGroupItem.className = "list-group-item";
                listGroupItem.appendChild(document.createTextNode(`地點 ${getgatheringDetails.data[0].place}`))


                let startTime = new Date(getgatheringDetails.data[0].start_at)


                let time = document.createElement('li');
                time.className = "list-group-item";
                time.appendChild(document.createTextNode(`時間 ${startTime.getUTCFullYear()}-${((parseInt(startTime.getUTCMonth()) + 1) < 10 ? '0' : '') + (parseInt(startTime.getUTCMonth()) + 1)}-${(startTime.getUTCDate() < 10 ? '0' : '') + startTime.getUTCDate()}  ${(startTime.getUTCHours() < 10 ? '0' : '') + startTime.getUTCHours()}:${(startTime.getUTCMinutes() < 10 ? '0' : '') + startTime.getUTCMinutes()}`))



                // let minParticipant = document.createElement('li');
                // minParticipant.className = "list-group-item";
                // minParticipant.appendChild(document.createTextNode(`幾人成團 ${getgatheringDetails.data[0].min_participant}`))



                let maxParticipant = document.createElement('li');
                maxParticipant.className = "list-group-item";
                maxParticipant.appendChild(document.createTextNode(`人數上限 ${getgatheringDetails.data[0].max_participant}`))


                let currentParticipant = document.createElement('li');
                currentParticipant.className = "list-group-item";
                currentParticipant.appendChild(document.createTextNode(`目前人數 ${parseInt(gathering.numOfParticipants)}`))

                // ---------------------status-----------------------

                let statusObject = { 1: "已開團", 2: "招募中", 3: "已額滿", 4: "已結束" }
                let statusBarValue = { 1: "3%", 2: "33%", 3: "66%", 4: "100%" }


                document.getElementById('progressbar').style = `width: ${statusBarValue[getgatheringDetails.data[0].status]};`




                let host = document.createElement('li');
                host.className = "list-group-item";
                host.appendChild(document.createTextNode(`主揪 ${hostInfo.hostName}`))

                joinEventButton = document.getElementById('joinEvent')
                quitEventButton = document.getElementById('quitEvent')
                fullEventButton = document.getElementById('fullEvent')


                // let joinEventButton = document.createElement('a');
                // joinEventButton.className = "btn btn-primary";
                // joinEventButton.id = "joinEvent";
                // joinEventButton.style = "display: none;"
                // joinEventButton.setAttribute("data-bs-toggle", "button")
                // joinEventButton.setAttribute("autocomplete", "off")
                // joinEventButton.appendChild(document.createTextNode("我要加入"))


                // let quitEventButton = document.createElement('a');
                // quitEventButton.className = "btn btn-primary";
                // quitEventButton.id = "quitEvent";
                // quitEventButton.style = "display: none;"
                // quitEventButton.setAttribute("data-bs-toggle", "button")
                // quitEventButton.setAttribute("autocomplete", "off")
                // quitEventButton.appendChild(document.createTextNode("我要退出"))


                // let fullEventButton = document.createElement('a');
                // fullEventButton.className = "btn ";
                // fullEventButton.id = "fullEvent";
                // fullEventButton.style = "display: none; background-color: 'rebeccapurple';"
                // fullEventButton.setAttribute("data-bs-toggle", "button")
                // fullEventButton.setAttribute("autocomplete", "off")
                // fullEventButton.appendChild(document.createTextNode("名額已滿"))


                console.log('check', parseInt(gathering.numOfParticipants), getgatheringDetails.data[0].max_participant)
                if ((parseInt(gathering.numOfParticipants)) >= getgatheringDetails.data[0].max_participant) {
                    joinEventButton.style = "display: none;"
                    fullEventButton.style = "display: block;"
                } else {
                    joinEventButton.style = "display: block;"
                    fullEventButton.style = "display: none;"
                }

                // let returnHome = document.createElement('a');
                // returnHome.className = "btn btn-primary btn-sm box4";


                // returnHome.setAttribute("onclick", 'location.href=" /index.html"')
                // returnHome.setAttribute("data-bs-toggle", "button")
                // returnHome.setAttribute("autocomplete", "off")
                // returnHome.appendChild(document.createTextNode("回首頁"))




                listGroup.appendChild(listGroupItem)
                listGroup.appendChild(time)
                // listGroup.appendChild(minParticipant)
                listGroup.appendChild(maxParticipant)
                listGroup.appendChild(currentParticipant)

                // listGroup.appendChild(statusCode)
                listGroup.appendChild(host)
                // listGroup.appendChild(joinEventButton)
                // listGroup.appendChild(quitEventButton)
                // listGroup.appendChild(fullEventButton)

                listGroup.appendChild(document.createElement('br'))
                // listGroup.appendChild(returnHome)

                // gatheringDetail.insertBefore(eventMap, gatheringDetail.firstChild)

                // gatheringDetail.appendChild(eventMap)

                // gatheringDetail.insertBefore(statusCode, gatheringDetail.firstChild)

                gatheringDetail.insertBefore(listGroup, gatheringDetail.firstChild)
                // gatheringDetail.appendChild(listGroup)

                gatheringDetail.insertBefore(cardBody, gatheringDetail.firstChild)



                gatheringDetail.insertBefore(eventPic, gatheringDetail.firstChild)








                let commentListBlock = document.getElementById('commentList')
                commentListBlock.style = "width: 80%; margin-top: 15px;"

                for (i in commentList.data.comments) {

                    let commentCard = document.createElement('div')
                    commentCard.id = "commentCard";
                    commentCard.className = "card";
                    commentCard.style = "height: 10rem;"
                    let commentCardBody = document.createElement('div')
                    let commentCardTitle = document.createElement('h5')
                    commentCardTitle.className = "card-title"
                    commentCardTitle.textContent = commentList.data.comments[i].name
                    let commentCardDate = document.createElement('h6')
                    commentCardDate.className = "card-subtitle mb-2 text-muted"
                    let startTime = new Date(commentList.data.comments[i].created_at)
                    commentCardDate.textContent = `時間 ${startTime.getUTCFullYear()}-${((parseInt(startTime.getUTCMonth()) + 1) < 10 ? '0' : '') + (parseInt(startTime.getUTCMonth()) + 1)}-${(startTime.getUTCDate() < 10 ? '0' : '') + startTime.getUTCDate()}  ${(startTime.getUTCHours() < 10 ? '0' : '') + startTime.getUTCHours()}:${(startTime.getUTCMinutes() < 10 ? '0' : '') + startTime.getUTCMinutes()}`

                    let commentText = document.createElement('p')
                    commentText.className = "card-text";
                    commentText.textContent = commentList.data.comments[i].comment



                    commentCardBody.appendChild(commentCardTitle)
                    commentCardBody.appendChild(commentCardDate)
                    commentCardBody.appendChild(commentText)

                    commentCard.appendChild(commentCardBody)


                    commentListBlock.appendChild(commentCard)

                }














                let returnHome = document.createElement('a');
                returnHome.className = "btn btn-primary btn-sm box4";


                returnHome.setAttribute("onclick", 'location.href="/index.html"')
                returnHome.setAttribute("data-bs-toggle", "button")
                returnHome.setAttribute("autocomplete", "off")
                returnHome.appendChild(document.createTextNode("回首頁"))

                gatheringDetail.appendChild(document.createElement('br'))

                gatheringDetail.appendChild(returnHome)









                // -------------------------- current rating ---------------------




                let ratingScore = parseFloat(getgatheringDetails.data[0].avg_rating).toFixed(2)
                // let ratingScore = 3.51



                if (ratingScore == 0) {
                    document.getElementById('rating-description').textContent = '目前尚未有人給評分'
                } else {
                    document.getElementById('rating-description').textContent = `${ratingScore} / 5`
                }



                const stars = document.querySelector(".ratingResult").children;
                // let ratingValue
                let index //目前選到的星星

                for (let j = 0; j < stars.length; j++) {
                    stars[j].classList.remove("fa-star")//reset 所有星星
                    stars[j].classList.add("fa-star-o")
                }
                for (let j = 0; j < ratingScore - 0.5; j++) {
                    stars[j].classList.remove("fa-star-o")
                    stars[j].classList.add("fa-star")
                }




                const initPoint = { lat: getgatheringDetails.data[0].lat, lng: getgatheringDetails.data[0].lng };
                console.log('initPoint', initPoint)
                map = new google.maps.Map(document.getElementById("left-map"), {
                    center: initPoint,
                    zoom: 18,
                    fullscreenControl: false,
                    mapTypeControl: false,
                    styles: [
                        {
                            "featureType": "landscape.man_made",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "color": "#f7f1df"
                                }
                            ]
                        },
                        {
                            "featureType": "landscape.natural",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "color": "#d0e3b4"
                                }
                            ]
                        },
                        {
                            "featureType": "landscape.natural.terrain",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        // {
                        //     "featureType": "poi",
                        //     "elementType": "labels",
                        //     "stylers": [
                        //         {
                        //             "visibility": "off"
                        //         }
                        //     ]
                        // },
                        {
                            "featureType": "poi.business",
                            "elementType": "all",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "poi.medical",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "color": "#fbd3da"
                                }
                            ]
                        },
                        {
                            "featureType": "poi.park",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "color": "#bde6ab"
                                }
                            ]
                        },
                        {
                            "featureType": "road",
                            "elementType": "geometry.stroke",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "road",
                            "elementType": "labels",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "road.highway",
                            "elementType": "geometry.fill",
                            "stylers": [
                                {
                                    "color": "#ffe15f"
                                }
                            ]
                        },
                        {
                            "featureType": "road.highway",
                            "elementType": "geometry.stroke",
                            "stylers": [
                                {
                                    "color": "#efd151"
                                }
                            ]
                        },
                        {
                            "featureType": "road.arterial",
                            "elementType": "geometry.fill",
                            "stylers": [
                                {
                                    "color": "#ffffff"
                                }
                            ]
                        },
                        {
                            "featureType": "road.local",
                            "elementType": "geometry.fill",
                            "stylers": [
                                {
                                    "color": "black"
                                }
                            ]
                        },
                        {
                            "featureType": "transit.station.airport",
                            "elementType": "geometry.fill",
                            "stylers": [
                                {
                                    "color": "#cfb2db"
                                }
                            ]
                        },
                        {
                            "featureType": "water",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "color": "#a2daf2"
                                }
                            ]
                        }
                    ]
                });

                // let mapDiv = document.getElementById("left-map")
                // mapDiv.style = 'height: 100%;width: 98%;'


                let marker = new google.maps.Marker()

                marker = new google.maps.Marker({
                    position: initPoint, //marker的放置位置

                    map: map
                });








                let participant;
                url = location.href
                // const gatheringId = url.split('?')[1].split('=')[1]



                const messages = document.getElementById('messages');
                const form = document.getElementById('messagesForm');
                const input = document.getElementById('messageInput');
                const right = document.getElementById('right');
                const joinEvent = document.getElementById('joinEvent');
                const quitEvent = document.getElementById('quitEvent');
                const actionButtons = document.getElementById('action-buttons')




                // ----------------------------------------------------------------------------------------








                if (accessToken) {


                    let profile = await fetchData('/api/1.0/user/getmemberprofile', accessToken)

                    console.log('response getmemberprofile', profile)


                    user = profile.data
                    console.log('user', user)
                    // messages.style = "display:block;"
                    // form.style = "display:block;"
                    // right.style = "display:block;"

                    if (user.id == hostInfo.hostId) {
                        console.log('is host')
                        right.style = "display:block;"
                        joinEvent.style = "display:none;"
                        fullEvent.style = "display:none;"
                        quitEvent.style = "display:none;"
                        actionButtons.style = "display:none;"
                        // gatheringDetail.style = "width: 45%"

                    }




                    let participantsData = await fetchData(`/api/1.0/getgatherings/participants?id=${gatheringId}`, accessToken)


                    console.log('participantsData', participantsData)

                    let participants = document.getElementById('participants')


                    // ---------------Host Block-------------

                    // const hostNameForChatRoom = document.createElement('li');

                    // hostNameForChatRoom.textContent = `主揪 ${hostInfo.hostName} `

                    // participants.appendChild(hostNameForChatRoom);

                    const hostForChatRoom = document.createElement('div');

                    hostForChatRoom.setAttribute('class', 'card-header host-header')

                    hostForChatRoom.setAttribute('onclick', `location.href='/profile.html?id=${hostInfo.hostId}';`)

                    hostForChatRoom.style = " cursor:pointer;"





                    let hostRow = document.createElement('div')
                    hostRow.setAttribute('class', 'row g-0')
                    hostRow.style = "align-items: center;"

                    let hostRowPic = document.createElement('div')
                    hostRowPic.setAttribute('class', 'col-md-4')
                    hostRowPic.style = "display: flex; flex-direction:column; justify-content:center;width:min-content;"

                    let hostPic = document.createElement('img')
                    hostPic.setAttribute('class', 'figure-img img-fluid rounded participant-pic')
                    hostPic.setAttribute('src', hostInfo.picture)
                    hostPic.style = "margin: 3px; object-fit: contain; height: 50%; max-width:45px;"

                    hostRowPic.appendChild(hostPic)

                    let hostRowContent = document.createElement('div')
                    hostRowContent.setAttribute('class', 'col-md-8')

                    let hostRowCardBody = document.createElement('div')
                    hostRowCardBody.setAttribute('class', 'card-body')



                    let hostRowCardText = document.createElement('p')
                    hostRowCardText.setAttribute('class', 'card-text')
                    hostRowCardText.appendChild(document.createTextNode(` ${hostInfo.hostName}`))





                    hostRowCardBody.appendChild(hostRowCardText)


                    hostRowContent.appendChild(hostRowCardBody)


                    hostRow.appendChild(hostRowPic)
                    hostRow.appendChild(hostRowContent)


                    hostForChatRoom.appendChild(hostRow)











                    participants.appendChild(hostForChatRoom);

                    // ----------------------------------------------


                    // joinEvent.style = "display:block;"
                    // quitEvent.style = "display:none;"


                    // --------------- render participant --------------         


                    async function renderParticipants() {

                        participantsData = await fetchData(`/api/1.0/getgatherings/participants?id=${gatheringId}`, accessToken)
                        participants.innerHTML = ""
                        participants.appendChild(hostForChatRoom);

                        for (let i in participantsData.data) {

                            console.log('participantsData.data[i]', participantsData.data[i].id, user.id)

                            if (user.id == participantsData.data[i].id) {
                                console.log('in participant list')
                                right.style = "display:block;"
                                joinEvent.style = "display:none;"
                                fullEvent.style = "display:none;"
                                quitEvent.style = "display:block;"
                                actionButtons.style = "display:none;"

                                // gatheringDetail.style = "width: 45%"

                            }




                            let participant = document.createElement('div')
                            participant.setAttribute('class', 'card mb-3 participant')
                            // eventBlock.setAttribute('onclick', `return clickGathering(${response.data[i].id});`)
                            // participant.setAttribute('onclick', `location.href='/profile.html?id=${participantsData.data[i].id}';`)
                            participant.setAttribute('id', participantsData.data[i].id)
                            participant.style = "max-width: 100%; cursor:pointer; margin:0!important;"



                            let participantRow = document.createElement('div')
                            participantRow.setAttribute('class', 'row g-0')
                            participantRow.style = "align-items: center; width:10rem;"
                            participantRow.setAttribute('onclick', `location.href='/profile.html?id=${participantsData.data[i].id}';`)


                            let participantRowPic = document.createElement('div')
                            participantRowPic.setAttribute('class', 'col-md-4')
                            participantRowPic.style = "display: flex; flex-direction:column; justify-content:center;width:min-content;"

                            let participantPic = document.createElement('img')
                            participantPic.setAttribute('class', 'figure-img img-fluid rounded participant-pic')
                            participantPic.setAttribute('src', participantsData.data[i].picture)
                            participantPic.style = "margin: 3px; object-fit: contain; height: 50%; max-width:45px;"

                            participantRowPic.appendChild(participantPic)

                            let participantRowContent = document.createElement('div')
                            participantRowContent.setAttribute('class', 'col-md-8')

                            let participantRowCardBody = document.createElement('div')
                            participantRowCardBody.setAttribute('class', 'card-body')



                            let participantRowCardText = document.createElement('p')
                            participantRowCardText.setAttribute('class', 'card-text')
                            participantRowCardText.style = "width:10rem;"
                            participantRowCardText.appendChild(document.createTextNode(` ${participantsData.data[i].user_name}`))






                            participantRowCardBody.appendChild(participantRowCardText)

                            participantRowContent.appendChild(participantRowCardBody)

                            participantRow.appendChild(participantRowPic)
                            participantRow.appendChild(participantRowContent)







                            let removeIcon = document.createElement('img');
                            removeIcon.setAttribute('src', "https://my-personal-project-bucket.s3.ap-northeast-1.amazonaws.com/img/member/103763_close_user_remove_icon.png")
                            // removeIcon.setAttribute('onclick', `removeParticipant(${gatheringId}, ${participantsData.data[i].id})`)
                            // removeIcon.setAttribute('class', "btn btn-primary")
                            removeIcon.setAttribute('data-bs-toggle', "modal")
                            removeIcon.setAttribute('data-bs-target', "#removeParticipantModal")

                            removeIcon.setAttribute('data-bs-participantId', participantsData.data[i].id)
                            removeIcon.setAttribute('data-bs-participantName', participantsData.data[i].user_name)
                            removeIcon.setAttribute('data-bs-GatheringId', gatheringId)
                            removeIcon.setAttribute('data-bs-HostId', hostInfo.hostId)
                            removeIcon.setAttribute('type', "button")
                            removeIcon.setAttribute('data-bs-whatever', "@mdo")


                            if (user.id == hostInfo.hostId) {
                                removeIcon.style = "width:1.3rem; height:1.3rem; margin-right: 5px;"
                            } else {
                                removeIcon.style = "width:1.3rem; height:1.3rem;  margin-right: 5px; display:none;"

                            }








                            participant.appendChild(participantRow)
                            participant.appendChild(removeIcon)

                            participants.appendChild(participant)
                            // gatheringList.appendChild(document.createElement('br'))



                        }



                    }

                    renderParticipants()



                    let removeParticipantModal = document.getElementById('removeParticipantModal')
                    removeParticipantModal.addEventListener('show.bs.modal', function (event) {
                        // Button that triggered the modal
                        let button = event.relatedTarget
                        // Extract info from data-bs-* attributes
                        let participantId = button.getAttribute('data-bs-participantId')
                        let gatheringId = button.getAttribute('data-bs-gatheringId')
                        let participantName = button.getAttribute('data-bs-participantName')
                        let hostId = button.getAttribute('data-bs-hostId')
                        // If necessary, you could initiate an AJAX request here
                        // and then do the updating in a callback.
                        //
                        // Update the modal's content.

                        let modalBody = removeParticipantModal.querySelector('#removeParticipantModalBody')

                        modalBody.textContent = `確定要將 ${participantName} 移出活動嗎？`



                        let removeParticipantModalConfirm = document.getElementById('removeParticipantModalConfirm')


                        removeParticipantModalConfirm.addEventListener('click', async function (event) {

                            // alert(`${hostId} 將 ${participantName} 移出活動`)


                            let removeParticipantAdmin = await fetchData(`/api/1.0/gatherings/removeparticipantadmin?gathering_id=${gatheringId}&participant_id=${participantId}&host_id=${hostId}`, accessToken)


                            // console.log('removeParticipantAdmin.status', removeParticipantAdmin)

                            if (removeParticipantAdmin.error == 'No Permission') {
                                Swal.fire({
                                    title: 'Error!',
                                    text: '您無權限進行此操作',
                                    icon: 'error',
                                    confirmButtonText: 'OK'
                                })

                            } else {
                                Swal.fire({
                                    title: 'Success!',
                                    text: '已將用戶移出',
                                    icon: 'success',
                                    confirmButtonText: 'OK'
                                }).then(function () {
                                    // window.location.reload();
                                    let participantData = { gatheringId: gatheringId, gatheringTitle: gathering.title, hostId: hostInfo.hostId, hostName: hostInfo.hostName, participantName: participantName, participantId: participantId }

                                    socket.emit('removeParticipantAdmin', participantData)

                                }).then(function () {
                                    console.log('renderParticipants()')
                                    renderParticipants()
                                })





                            }





                            // socket.emit('removeParticipant', participantData)


                            // socket.emit(`host_newparticipant_${ participantData.hostId } `, msg.content)






                        })









                    })







                    // ------------------------------------------------------------------------------------




                    let chatRecord
                    socket.on('addRoom', message => {
                        console.log(message)



                    })





                    // let room = 'room1'
                    let room = location.href.split('?')[1].split('=')[1]

                    // console.log('{ room: room, userId: user.id }', room, user.id)
                    socket.emit('addRoom', { room: room, userId: user.id })

                    socket.on(`${room}+${user.id}`, chatRecord => {
                        // console.log('chatRecord', chatRecord)



                        // item.textContent = userName + ':' + msg;
                        // let messages = document.getElementById('messages')
                        let item;
                        for (let i in chatRecord) {
                            // console.log('current user.id', user.id)
                            // console.log('chatRecord[i].user_id', chatRecord[i].user_id)
                            item = document.createElement('li');
                            item.setAttribute('class', 'rounded-pill')

                            // console.log('comapre', 'chatRecord[i].user_id: ', chatRecord[i].user_id, 'user.id:', user.id)

                            if (chatRecord[i].user_id == user.id) {
                                // item.style = 'margin: 3px 3px 3px auto;'
                                item.classList.add('class', 'message-myself')
                                item.textContent = `${chatRecord[i].content} `
                            } else {
                                item.textContent = `${chatRecord[i].user_name}: ${chatRecord[i].content} `;
                                // item.style = 'margin: 3px 3px 3px 3px;'
                                item.classList.add('class', 'message-others')
                            }

                            messages.appendChild(item);

                        }


                        document.getElementById('messages').scrollBy(0, document.getElementById('messages').scrollHeight)





                    })









                    const messages = document.getElementById('messages');
                    const form = document.getElementById('messagesForm');
                    const input = document.getElementById('messageInput');

                    let messagesList = []
                    let chat
                    form.addEventListener('submit', function (e) {
                        console.log('submit')
                        e.preventDefault();
                        if (input.value) {
                            console.log('input.value', input.value)
                            console.log('user.id', user.id)
                            chat = { speaker: user.name, content: input.value, roomId: room, userId: user.id }
                            // chat.speaker = user.name
                            // chat.content = input.value
                            socket.emit('chat message', chat);

                            messagesList.push(chat)
                            input.value = '';
                            console.log(messagesList)
                        }
                    })


                    let item;
                    socket.on('chat message', function (msg) {
                        item = document.createElement('li');
                        // item.textContent = userName + ':' + msg;

                        // console.log('comapre', 'msg.speaker: ', msg.speaker, 'user.name:', user.name)
                        item.setAttribute('class', 'rounded-pill')
                        if (msg.speaker == user.name) {
                            // item.style = 'margin: 3px 3px 3px auto;'
                            item.textContent = `${msg.content}`;
                            item.classList.add('class', 'message-myself')
                        } else {
                            item.textContent = `${msg.speaker}: ${msg.content} `;
                            // item.style = 'margin: 3px 3px 3px 3px;'
                            item.classList.add('class', 'message-others')

                            Swal.fire({
                                title: `${msg.speaker} say: ${msg.content} `,
                                position: 'bottom-end',
                                showClass: {

                                    popup: 'animate__animated animate__fadeIn'
                                },

                                timer: 1500,
                                hideClass: {
                                    popup: 'animate__animated animate__fadeOutUp'
                                },
                                backdrop: false,
                                width: '18rem',
                            })

                        }

                        messages.appendChild(item);

                        document.getElementById('messages').scrollBy(0, document.getElementById('messages').scrollHeight)



                    })




                    socket.on(`all_changeParticipant_${location.href.split('?')[1].split('=')[1]}`, function (msg) {

                        // window.location.reload()

                        renderParticipants()


                    })

                    // console.log(`all_changeParticipant_${location.href.split('?')[1].split('=')[1]}_${user.id}`, `all_changeParticipant_${location.href.split('?')[1].split('=')[1]}_${user.id}`)

                    socket.on(`all_changeParticipant_${location.href.split('?')[1].split('=')[1]}_${user.id}`, async function (msg) {


                        console.log(`all_changeParticipant_${location.href.split('?')[1].split('=')[1]}_${user.id}`, `all_changeParticipant_${location.href.split('?')[1].split('=')[1]}_${user.id}`)





                        await Swal.fire({
                            title: 'Warning!',
                            text: '您已被管理者移出活動',
                            icon: 'warning',
                            confirmButtonText: 'OK'
                        })
                        window.location.href = '/index.html'

                    })





                } else {

                    // messages.style = "display:none;"
                    // form.style = "display:none;"
                    right.style = "display:none;"
                    gatheringDetail.style = "width:90%;"


                }














                document.getElementById("joinEvent").addEventListener('click', async () => {

                    // const gatheringId = url.split('?')[1].split('=')[1]

                    // const accessToken = localStorage.getItem("token")

                    console.log('userjoinEvent', user)

                    if (accessToken) {

                        if (parseInt(user.popularity) < 5) {


                            Swal.fire({
                                title: 'Error!',
                                text: '積分點數不足',
                                icon: 'error',
                                confirmButtonText: 'OK'
                            }).then(function () {
                                window.location.href = '/index.html'
                            })

                        } else {




                            let joinGathering = await fetchData(`/api/1.0/gatherings/attendGathering/join?id=${gatheringId}`, accessToken)



                            console.log('joinGathering', joinGathering)


                            let participantData = { gatheringId: gatheringId, gatheringTitle: gathering.title, hostId: hostInfo.hostId, hostName: hostInfo.hostName, participantName: joinGathering.data.participant.participant_name, participantId: joinGathering.data.participant.participant_id }


                            console.log('participantData', participantData)


                            socket.emit('addParticipant', participantData)


                            // socket.emit(`host_newparticipant_${ participantData.hostId } `, msg.content)

                            // alert('成功加入')

                            Swal.fire({
                                title: 'Success!',
                                text: '成功加入，已為您扣除5點積分',
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then(function () {
                                renderParticipants()

                                right.style = "display:block;"
                                joinEvent.style = "display:none;"
                                fullEvent.style = "display:none;"
                                quitEvent.style = "display:block;"
                                actionButtons.style = "display:none;"


                            })



                        }



                    } else {

                        Swal.fire({
                            title: 'Error!',
                            text: '請先登入',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        }).then(function () {
                            window.location.href = '/sign.html'
                        })

                    }

                })



                document.getElementById("quitEvent").addEventListener('click', async () => {

                    // const gatheringId = url.split('?')[1].split('=')[1]

                    // const accessToken = localStorage.getItem("token")

                    if (accessToken) {

                        let quitGathering = await fetchData(`/api/1.0/gatherings/attendGathering/quit?id=${gatheringId}`, accessToken)



                        console.log('quitGathering', quitGathering)


                        let participantData = { gatheringId: gatheringId, gatheringTitle: gathering.title, hostId: hostInfo.hostId, hostName: hostInfo.hostName, participantName: quitGathering.data.participant.participant_name, participantId: quitGathering.data.participant.participant_id }


                        console.log('participantData', participantData)

                        alert('成功退出')
                        socket.emit('removeParticipant', participantData)


                        // socket.emit(`host_newparticipant_${ participantData.hostId } `, msg.content)




                        window.location.reload();




                    } else {

                        Swal.fire({
                            title: 'Error!',
                            text: '請先登入',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        }).then(function () {
                            window.location.href = '/sign.html'
                        })

                    }

                })




















            } else {
                console.log('wrong parameter')
            }










            if (user.id == hostInfo.hostId) {

                joinEvent.style = "display:none;"
                fullEvent.style = "display:none;"
                quitEvent.style = "display:none;"
                actionButtons.style = "display:none;"
            }










            //    --------------------------------------system messages block---------------------------- -->



            const renderSystemMessage = async function (accessToken) {



                let systemMessageRecord = await fetchData(`/api/1.0/chat/getsystemrecord`, accessToken)



                // console.log('systemMessageRecord.data[0].content', systemMessageRecord.data[0].content)


                let sysMessageList = document.getElementById('sys-message-list')


                for (let i in systemMessageRecord.data) {
                    // console.log('current user.id', user.id)
                    // console.log('chatRecord[i].user_id', chatRecord[i].user_id)
                    let sysMessageItem = document.createElement('li');

                    // console.log('compare', 'chatRecord[i].user_id: ', chatRecord[i].user_id, 'user.id:', user.id)
                    sysMessageItem.className = "list-group-item"
                    sysMessageItem.innerText = systemMessageRecord.data[i].content
                    let sysMessageItemSmall = document.createElement('small');
                    sysMessageItemSmall.className = "text-muted";
                    let startTime = new Date(systemMessageRecord.data[i].created_at);
                    sysMessageItemSmall.innerText = `${startTime.getUTCFullYear()}-${((parseInt(startTime.getUTCMonth()) + 1) < 10 ? '0' : '') + (parseInt(startTime.getUTCMonth()) + 1)}-${(startTime.getUTCDate() < 10 ? '0' : '') + startTime.getUTCDate()}  ${(startTime.getUTCHours() < 10 ? '0' : '') + startTime.getUTCHours()}:${(startTime.getUTCMinutes() < 10 ? '0' : '') + startTime.getUTCMinutes()}`









                    sysMessageItem.appendChild(sysMessageItemSmall)


                    sysMessageList.appendChild(sysMessageItem);

                }


                sysMessageList.scrollBy(0, sysMessageList.scrollHeight)




            }







            renderSystemMessage(accessToken)


            // ---------------------------------------------------------------------------------------------- 

















            var ratingScore = {}

            var commentModal = document.getElementById('commentModal')
            commentModal.addEventListener('show.bs.modal', function (event) {
                // Button that triggered the modal
                var button = event.relatedTarget
                // Extract info from data-bs-* attributes
                ratingScore.score = button.getAttribute('data-bs-rating')
                // If necessary, you could initiate an AJAX request here
                // and then do the updating in a callback.
                //
                // Update the modal's content.
                var modalTitle = commentModal.querySelector('.modal-title')
                // var modalBodyInput = exampleModal.querySelector('.modal-body input')

                modalTitle.textContent = '您給的分數為 ' + ratingScore.score + ' 顆星'
                // modalBodyInput.value = recipient
            })







            const sendCommentButton = document.getElementById('sendCommentButton')
            sendCommentButton.addEventListener('click', async function (event) {
                if (!accessToken) {
                    console.log('請先登入再進行評論')
                    await Swal.fire({
                        title: 'Error!',
                        text: '請先登入再進行評論',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    }).then(function () {
                        window.location.href = '/sign.html';
                    })
                }

                let commentData = {
                    gatheringId: location.href.split('?')[1].split('=')[1],
                    hostId: hostInfo.hostId,
                    rating: ratingScore.score,
                    comment: document.getElementById('message-text').value
                }

                console.log('commentData', commentData)

                const commentHeaders = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                }

                fetch('/api/1.0/gatherings/feedback', { headers: commentHeaders, body: JSON.stringify(commentData), method: 'POST' })

                    .then((response) => { return response.json(); })
                    .then((response) => { console.log('comment successful', response) })
                    .then(() => {

                        Swal.fire({
                            title: 'Success!',
                            text: '您的評論已送出',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then(function () {
                            window.location.reload();
                        })

                    })
                    .catch((error) => {
                        console.log(error);
                    })








            })



        }





    </script>


    <script>
        // 當觸發連線建立事件
        // 發送 greet 事件給伺服器
        // socket.on("connect", function () {
        //     socket.emit("greet");
        // });

        // 當收到伺服器回傳到 greet 事件
        // 將內容轉到 div 中呈現
        // socket.on("greet", function (msg) {
        //     document.getElementById("groupChatRoom").innerText = msg;
        // });
    </script>


    <script>


        // document.addEventListener("DOMContentLoaded", () => {

        //     var status = document.getElementById("status");
        //     var online = document.getElementById("online");

        //     socket.on("connect", function () {
        //         status.innerText = "Connected.";
        //     });

        //     socket.on("disconnect", function () {
        //         status.innerText = "Disconnected.";
        //     });

        //     socket.on("online", function (amount) {
        //         online.innerText = amount;
        //     });
        // });


    </script>

    <script>



        // var socket = io();
        // const form = document.getElementById('messagesForm');
        // const input = document.getElementById('messageInput');



        // //  const accessToken = localStorage.getItem("token");
        // // fetch("/api/1.0/getgatherings/hostGathering", {

        // //     body: dataToSent,
        // //     headers: new Headers({
        // //         "Content-Type": "multipart/form-data",
        // //         "Authorization": `Bearer ${accessToken}`
        // //     }),
        // //     method: "POST"
        // // }).then((e => e.json())).then((e => {
        // //     console.log(e)
        // //     alert('error')
        // // }
        // // )).then(window.alert("註冊成功！")).catch((e => {
        // //     console.log(e)
        // // }
        // // ))

        // // socket.on('create-room', () => {
        // //     const roomId = uuid(`${Date.now()}`, uuid.DNS);
        // //     socket.join(roomId);
        // //     socket.emit('join-room-message', `You've join ${roomId} room`);
        // //     io.to(roomId).emit('room-brocast', `${socket.id} has join this room`);
        // // })

        // // socket.on('join-room', (roomId) => {
        // //     socket.join(roomId);
        // //     socket.emit('join-room-message', `You've join ${roomId} room`);
        // //     io.sockets.to(roomId).emit('room-brocast', `${socket.id} has join this room`);
        // // });


        // socket.on('addRoom', message => {
        //     console.log(message)
        // })





        // // let room = 'room1'
        // let room = location.href.split('?')[1].split('=')[1]
        // socket.emit('addRoom', room)

        // let messagesList = []

        // form.addEventListener('submit', function (e) {
        //     console.log('submit')
        //     e.preventDefault();
        //     if (input.value) {
        //         console.log('input.value', input.value)
        //         socket.emit('chat message', input.value);
        //         messagesList.push(input.value)
        //         input.value = '';
        //     }
        // })



        // socket.on('chat message', function (msg) {
        //     const item = document.createElement('li');
        //     // item.textContent = userName + ':' + msg;
        //     item.textContent = msg;
        //     messages.appendChild(item);
        //     document.getElementById('messages').scrollBy(0, document.getElementById('messages').scrollHeight)

        // })

    </script>


    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbmXJHj0WUd8Zy-neXlew88hmIkB4bnwI&callback=initMap&v=weekly"
        async></script>




    <!-- -------------------js for header------------------ -->


    <script>






        document.getElementById("navbarDropdownMenuLink").addEventListener('click', () => {
            if (!localStorage.getItem('token')) {
                document.getElementsByClassName('dropdown-sign')[0].style = "display: block;"
                let sign = document.getElementsByClassName('dropdown-signed')
                for (i = 0; i < sign.length; i++) {
                    sign[i].style.display = "none";
                }

            } else {
                document.getElementsByClassName('dropdown-sign')[0].style = "display: none;"
                let signed = document.getElementsByClassName('dropdown-signed')
                for (i = 0; i < signed.length; i++) {
                    signed[i].style.display = "block";
                }

            }

        })


        document.getElementById("signout").addEventListener('click', () => {
            localStorage.removeItem("token")


            Swal.fire({
                title: 'Success!',
                text: '已將您登出',
                icon: 'success',
                confirmButtonText: 'OK'
            }).then(function () {
                window.location.href = '/sign.html';
            })

        })




    </script>







</body>

</html>